{% extends "layouts/base_app.html" %}
{% load i18n %}
{% load money %}

{% block title %}{% trans "Pr√©stamos" %} ¬∑ Finanzas Bot{% endblock %}

{% block content %}
<div class="space-y-6">

  <div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold">ü§ù {% trans "Pr√©stamos" %}</h1>
      <p class="text-slate-300 text-sm">{% trans "Control de pr√©stamos y cuotas." %}</p>
    </div>

    <a href="{% url 'loans:create' %}"
       class="inline-flex items-center justify-center rounded-2xl border border-white/10 bg-white/10 hover:bg-white/15 px-4 py-2 text-sm">
      ‚ûï {% trans "Nuevo pr√©stamo" %}
    </a>
  </div>

  <form method="get" class="rounded-3xl border border-white/10 bg-white/5 p-4">
    <div class="flex flex-wrap items-end gap-3">
      <div class="w-56">
        <label class="text-xs text-slate-300">{% trans "Estado" %}</label>
        <select name="status" class="w-full rounded-xl bg-slate-950/40 border border-white/10 px-3 py-2 text-sm">
          <option value="">{% trans "Todos" %}</option>
          <option value="active" {% if status == "active" %}selected{% endif %}>{% trans "Activo" %}</option>
          <option value="closed" {% if status == "closed" %}selected{% endif %}>{% trans "Cerrado" %}</option>
          <option value="canceled" {% if status == "canceled" %}selected{% endif %}>{% trans "Cancelado" %}</option>
        </select>
      </div>

      <button class="rounded-2xl border border-white/10 bg-white/10 hover:bg-white/15 px-4 py-2 text-sm">
        {% trans "Filtrar" %}
      </button>

      <a href="{% url 'loans:list' %}" class="rounded-2xl border border-white/10 bg-transparent hover:bg-white/5 px-4 py-2 text-sm">
        {% trans "Limpiar" %}
      </a>
    </div>
  </form>

  <div class="overflow-x-auto rounded-3xl border border-white/10 bg-slate-950/40">
    <table class="min-w-full text-sm">
      <thead class="border-b border-white/10 bg-slate-950/60">
        <tr>
          <th class="text-left p-3">{% trans "Persona" %}</th>
          <th class="text-left p-3">{% trans "Direcci√≥n" %}</th>
          <th class="text-right p-3">{% trans "Monto" %}</th>
          <th class="text-left p-3">{% trans "Cuotas" %}</th>
          <th class="text-left p-3">{% trans "Estado" %}</th>
          <th class="text-right p-3"></th>
        </tr>
      </thead>
      <tbody>
        {% for l in loans %}
          <tr class="border-b border-white/5">
            <td class="p-3 text-slate-200 font-semibold">{{ l.person_name }}</td>
            <td class="p-3 text-slate-300">
              {% if l.direction == "lent" %}
                {% trans "Prest√© (me deben)" %}
              {% else %}
                {% trans "Me prestaron (yo debo)" %}
              {% endif %}
            </td>
            <td class="p-3 text-right font-semibold">
              {{ l.principal_original|money:l.currency_original }}
              <span class="text-slate-300 font-normal">{{ l.currency_original }}</span>
              {% if l.currency_original == "USD" %}
                <div class="text-xs text-slate-400">‚âà {{ l.principal_clp|money:"CLP" }} CLP</div>
              {% endif %}
            </td>
            <td class="p-3 text-slate-300">{{ l.installments_count }} ¬∑ {{ l.get_frequency_display }}</td>
            <td class="p-3">
              {% if l.status == "active" %}
                <span class="px-2 py-1 rounded-lg bg-emerald-500/15 border border-emerald-500/30">{% trans "Activo" %}</span>
              {% elif l.status == "closed" %}
                <span class="px-2 py-1 rounded-lg bg-slate-500/15 border border-slate-500/30">{% trans "Cerrado" %}</span>
              {% else %}
                <span class="px-2 py-1 rounded-lg bg-rose-500/15 border border-rose-500/30">{% trans "Cancelado" %}</span>
              {% endif %}
            </td>
            <td class="p-3 text-right">
              <a href="{% url 'loans:detail' l.id %}" class="text-sky-300 hover:text-sky-200">{% trans "Ver" %} ‚Üí</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="p-4 text-slate-300">{% trans "A√∫n no tienes pr√©stamos." %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}